<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heroku Playwright Example</title>
    <link rel="icon"
        href="https://bigwestplayground.com/theultimatic/wp-content/uploads/dynamik-gen/theme/images/ultimatic-123.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.0/css/bulma.min.css"
        integrity="sha512-ADrqa2PY1TZtb/MoLZIZu/Z/LlPaWQeDMBV73EMwjGam43/JJ5fqW38Rq8LJOVGCDfrJeOMS3Q/wRUVzW5DkjQ=="
        crossorigin="anonymous" />
</head>

<body>
    <section class="hero">
        <div class="hero-body">
            <div class="container">
                <h1 class="title">
                    BWM Auto Shop
                </h1>
                <h2 class="subtitle">
                    A user interface for Abe's Bots
                </h2>
            </div>
        </div>
    </section>
    <div class="container pb-5">

        <div class="notification">
            <h1 class="title">Single-site H Scraper</h1>
            <p>Input a URL to scrape the H1 and H2 tags for the site (use https://)</p>
            <br>
            <div class="field has-addons">
                <div class="control is-expanded">
                    <input class="input is-fullwidth" type="url" value="https://bigwestplayground.com/theultimatic"
                        id="h-url">
                </div>
                <div class="control">
                    <a class="button is-info" id="hscrape-run">
                        Scrape H tags
                    </a>
                </div>
            </div>
            <div id="hscrape-results">
                <div id="h1-results"></div>
                <div id="h2-results"></div>
            </div>
        </div>

        
        <div class="notification">
            <h1 class="title">Site Check</h1>
            <p>Input a JSON array of URLs to scrape the Title, H1 and H2 tags, Schema, and any social links for each site</p>
            <br>
            <div id="file-js-example" class="file has-name">
                <label class="file-label">
                    <input class="file-input" type="file" name="">
                    <span class="file-cta">
                        <span class="file-icon">
                            <i class="fas fa-upload"></i>
                        </span>
                        <span class="file-label">
                            Choose a fileâ€¦
                        </span>
                    </span>
                    <span class="file-name">
                    No file uploaded
                    </span>
                </label>
            </div>
            <div id="hlist-results">
                <div id="h1-list-results"></div>
                <div id="h2-list-results"></div>
            </div>
        </div>
    </div>
    <footer class="footer">
        <div class="content has-text-centered">
            <p>
                well, that's it for now!~
            </p>
        </div>
    </footer>
    <script>
        (() => {
            // Hscraper
            const hscrapeBtn = document.querySelector("#hscrape-run")
            hscrapeBtn.addEventListener("click", (e) => {
                const hscrapeUrl = document.querySelector("#h-url")
                const searchParams = new URLSearchParams()
                searchParams.set("url", hscrapeUrl.value)

                const h1Results = document.querySelector("#h1-results")
                const h2Results = document.querySelector("#h2-results")
                h1Results.innerHTML = "...fetching H1s"
                h2Results.innerHTML = "...fetching H2s"
                fetch(`/hscrape?${searchParams.toString()}`)
                .then(response => {
                    h1Results.innerHTML = "<strong>H1s</strong>"
                    h2Results.innerHTML = "<strong>H2s</strong>"
                    return response.json()
                })
                .then(function(data) {
                    console.log(data)
                    data["h1s"].forEach(elem => h1Results.innerHTML += `<br> ${elem}`)
                    data["h2s"].forEach(elem => h2Results.innerHTML += `<br> ${elem}`)
                })
            })

            // hlist scraper
                const fileInput = document.querySelector('#file-js-example input[type=file]');
                fileInput.onchange = () => {
                    if (fileInput.files.length > 0) {
                    const fileName = document.querySelector('#file-js-example .file-name');
                    fileName.innerHTML = fileInput.files[0].name;
                    
                    const hlistResults = document.querySelector("#hlist-results")
                    hlistResults.innerHTML = "...please wait while those tags are fetched."
                    const data = fileInput.files[0];
                   
                    fetch('/hlist', {
                      method: 'POST', // *GET, POST, PUT, DELETE, etc.
                      mode: 'cors', // no-cors, *cors, same-origin
                      cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                      credentials: 'same-origin', // include, *same-origin, omit
                      headers: {
                        'Content-Type': 'application/json'
                        // 'Content-Type': 'application/x-www-form-urlencoded',
                      },
                      redirect: 'follow', // manual, *follow, error
                      referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
                      body: data // body data type must match "Content-Type" header
                    })
                    .then(response => response.json())
                    .then(data => {
                      hlistResults.innerHTML = "<h3>Results:</h3>"
                      data.forEach( (elem, index) => {
                        hlistResults.innerHTML += `<br><br><strong>Site ${index}: </strong> ${elem.site}`;
                        hlistResults.innerHTML += `<br><strong>Title: </strong> ${elem.title}`;
                        hlistResults.innerHTML += `<br><strong>H1s: </strong> ${elem.h1s}`;
                        hlistResults.innerHTML += `<br><strong>H2s: </strong> ${elem.h2s}`;
                        hlistResults.innerHTML += `<br><strong>Schema Data: </strong> ${elem.schema}`;
                        hlistResults.innerHTML += `<br><strong>Socials: </strong> ${elem.socials}`;
                      })
                      console.log('Success:', JSON.stringify(data));
                    })
                    .catch((error) => {
                      console.error('Error:', JSON.stringify(error));
                    });
                    }
                }

                
                
        })()
    </script>

</body>

</html>