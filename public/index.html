<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BWM Auto Shop</title>
    <link rel="icon"
        href="https://bigwestplayground.com/theultimatic/wp-content/uploads/dynamik-gen/theme/images/ultimatic-123.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.0/css/bulma.min.css"
        integrity="sha512-ADrqa2PY1TZtb/MoLZIZu/Z/LlPaWQeDMBV73EMwjGam43/JJ5fqW38Rq8LJOVGCDfrJeOMS3Q/wRUVzW5DkjQ=="
        crossorigin="anonymous" />
    <style>
      body {
        background: white;
        animation: color-me-in 300s infinite ease-in-out;
      }

      @keyframes color-me-in {
        100% {
          background: white;
        }
        90% {
          background: red;
        }
        80% {
          background: #FFA500;
        }
        70% {
          background: yellow;
        }
        60% {
          background: green;
        }
        50% {
          background: blue;
        }
        40% {
          background: #4B0082;
        }
        30% {
          background: #8F00FF;
        }
        20% {
          background: #7f1ae5;
        }
        10% {
          background: black;
        }
        0% {
          background: white;
        }
      }
    </style>
</head>

<body>
    <section class="hero">
        <div class="hero-body">
            <div class="container">
                <h1 class="title">
                    BWM Auto Shop
                </h1>
                <h2 class="subtitle">A user interface for Abe's Bots</h2>
                <br>
                <br>
                <p>Depending on the number of sites, each bot can take a little while.</p>
                <p>When the run is complete there will be a status message with a timestamp like "<em>MY_BOT_RUN</em> completed at Fri Aug 06 2021 14:32:22 GMT-0600 (Mountain Daylight Time)"</p>
            </div>
        </div>
    </section>
    <div class="container pb-5">

      <div class="notification">
        <label for="bot-select">Choose a bot &#x1F916; </label>
        <select name="bots" id="bot-select">
            <option value="none">-- &#x1F916; &#x1F916; &#x1F916; &#x1F916; &#x1F916; &#x1F916; &#x1F916; --</option>
            <option value="hscrape">Single-site H Scraper</option>
            <option value="seositecheck">SEO Site Check</option>
            <option value="lighthouse">Run Lighthouse</option>
            <option value="cfdns">Check Cloudflare and DNS</option>
            <option value="addpage">Add Page to Client Site</option>
            <option value="json2xlsx">Convert JSON to Xlxs</option>
        </select>
      </div>
      
      <div class="notification hscrape" style="display: none;">
          <h1 class="title">Single-site H Scraper</h1>
          <p>Input a URL to scrape the H1 and H2 tags for the site (use https://)</p>
          <br>
          <div class="field has-addons">
              <div class="control is-expanded">
                  <input class="input is-fullwidth" type="url" value="https://bigwestplayground.com/theultimatic"
                      id="h-url">
              </div>
              <div class="control">
                  <a class="button is-info" id="hscrape-run">
                      Scrape H tags
                  </a>
              </div>
          </div>
      </div>

      <div class="notification addpage" style="display: none;">
          <h1 class="title">Add a page to a WP site</h1>
          <p>Input the url of the site, the page title, and the content as html</p>
          <br>
          <div class="field has-addons">
              <div class="control is-expanded">
                  <input class="input is-fullwidth" type="url" value="https://bigwestplayground.com/theultimatic"
                      id="addpage-url">
              </div>
              <div class="control is-expanded">
                  <input class="input" type="url" value="my new page (from heroku)"
                      id="addpage-title">
              </div>
              <div class="control is-expanded">
                  <input class="input" type="url" value="<p>I was put here by a bot</p>"
                      id="addpage-text">
              </div>
              <div class="control">
                  <a class="button is-info" id="addpage-run">
                      add page
                  </a>
              </div>
          </div>
      </div>

      <div class="notification json2xlsx" style="display: none;">
          <h1 class="title">Convert JSON to xlsx</h1>
          <p>Paste your JSON in the box, hit the button, recieve an xlsx back</p>
          <br>
          <p>Note: Requires a JSON array [] of objects {}, with each object having the same set of keys (example below).
          The column headers of the resulting xlsx will be the names of the keys.</p>
          <div style="display: flex;">
            <div style="flex: 1; margin-right: 20px;">
<pre>                      (example)
[
  {
    "site": "https://mysite1.com/",
    "performance": 23,
    "bestPractices": 73,
    "accessibility": 97,
    "pwa": 50,
    "seo": 79
  },
  {
    "site": "https://mysite2.com/",
    "performance": 37,
    "bestPractices": 73,
    "accessibility": 77,
    "pwa": 42,
    "seo": 82
  },
  {
    "site": "https://mysite3.com",
    "performance": 55.00000000000001,
    "bestPractices": 73,
    "accessibility": 93,
    "pwa": 50,
    "seo": 93
  }
]         
</pre>
            </div>
            <div id="paste-json" style="flex: 1;">
                <form id="paste-json-form">
                  <textarea class="textarea" id="paste-json-input" rows=7 cols=50 value="" placeholder="paste json here"></textarea>
                  <input type="submit" name="submit" value="upload"></input>
                </form>
            </div>
          </div>
      </div>

        
        <div class="notification seositecheck" style="display: none;">
            <h1 class="title">SEO Site Check</h1>
            <p>Upload a JSON array of URLs, or paste a list of URLs (use https://) to scrape the title, H1 and H2 tags, schema, social links, as well as desktop and mobile speed scores.</p>
            <br>
            <div id="file-js-example" class="file has-name">
                <label class="file-label">
                    <input class="file-input" type="file" name="">
                    <span class="file-cta">
                        <span class="file-icon">
                            <i class="fas fa-upload"></i>
                        </span>
                        <span class="file-label">
                            Choose a file…
                        </span>
                    </span>
                    <span class="file-name">
                    No file uploaded
                    </span>
                </label>
            </div>
            <br>
            <div id="paste-list">
              <form id="paste-form">
                <textarea class="textarea" id="paste-input" rows=7 cols=50 value="" placeholder="paste urls here, 1 per line"></textarea>
                <input type="submit" name="submit" value="upload"></input>
              </form>
            </div>
        </div>

        <div class="notification lighthouse" style="display: none;">
            <h1 class="title">Run Lighthouse</h1>
            <p>Upload a JSON array of URLs, or paste a list of URLs (use https://) to run lighthouse on</p>
            <button class="button is-info is-invisible" id="lh-check" >view progress</button>
            <button class="button is-info is-invisible" id="lh-reset" >reset</button>
            <div id="file-js-example-lh" class="file has-name">
                <label class="file-label">
                    <input class="file-input" type="file" name="">
                    <span class="file-cta">
                        <span class="file-icon">
                            <i class="fas fa-upload"></i>
                        </span>
                        <span class="file-label">
                            Choose a file…
                        </span>
                    </span>
                    <span class="file-name file-name-lh">
                    No file uploaded
                    </span>
                </label>
            </div>
            <div id="paste-list-lh">
              <form id="paste-form-lh">
                <textarea class="textarea" id="paste-input-lh" rows=7 cols=50 value="" placeholder="paste urls here, 1 per line"></textarea>
                <input type="submit" name="submit" value="upload"></input>
              </form>
            </div>
        </div>

        <div class="notification cfdns" style="display: none;">
          <h1 class="title">Check Cloudflare and DNS</h1>
          <p>Upload a JSON array of domains, or paste a list of domains (no https://) to get the cloudflare status and DNS records</p>
          <br>
          <div id="file-js-example-cfdns" class="file has-name">
              <label class="file-label">
                  <input class="file-input" type="file" name="">
                  <span class="file-cta">
                      <span class="file-icon">
                          <i class="fas fa-upload"></i>
                      </span>
                      <span class="file-label">
                          Choose a file…
                      </span>
                  </span>
                  <span class="file-name">
                  No file uploaded
                  </span>
              </label>
          </div>
          <div id="paste-list-cfdns">
              <form id="paste-form-cfdns">
                <textarea class="textarea" id="paste-input-cfdns" rows=7 cols=50 value="" placeholder="paste urls here, 1 per line"></textarea>
                <input type="submit" name="submit" value="upload"></input>
              </form>
          </div>
    </div>

    <div class="notification status">
      <div class="websocket-test">
        <h1 class="title">Status</h1>
        <p id='pings'></p>
        <button id="copy">copy results to clipboard</button>
      </div>
      <br>
      <div id="results-container" style="max-height: 500px; overflow-y: scroll;"></div>
    </div>

    <footer class="footer">
        <div class="content has-text-centered">
            <p>
                well, that's it for now!~
            </p>
        </div>
    </footer>
    <script>
        (() => {
          const resultsContainer = document.querySelector("#results-container")
          const inputContainer = document.querySelector("#input-container")
          // start things off by resetting data
          fetch(`/reset`)
          .then(response => response.json())
          .then(data => {
            resultsContainer.innerHTML = `<br><pre>${JSON.stringify(data, null, 2)}</pre>`
          }) 
          
          //websocket stuff
          const status = document.querySelector('#pings')
          const host = location.origin.replace(/^http/, 'ws')
          const ws = new WebSocket(host);
          ws.onmessage = function (event) {
          let obj = JSON.parse((event.data))
          let last_item = obj[obj.length - 1]
          if (last_item.message) {
            status.innerHTML = `${last_item.message}`
          } else if (last_item.data_type) {
            status.innerHTML = `currently checking ${last_item.data_type} on ${last_item.site}`
          } else if (item.in_cf) {
            status.innerHTML = `currently checking CF & DNS on ${last_item.site}`
          }
            resultsContainer.innerHTML = `<br><pre>${JSON.stringify(obj, null, 2)}</pre>` 
          };


          // bot select menu
          const botSelect = document.querySelector("#bot-select")
          const botContainer = document.querySelector('#bot-container');
          const bot_names = ["hscrape", "seositecheck", "lighthouse", "cfdns", "addpage", "json2xlsx"]
          botSelect.addEventListener("change", (event) => {
            fetch(`/reset`)
            .then(response => response.json())
            .then(data => {
              resultsContainer.innerHTML = `<br><pre>${JSON.stringify(data, null, 2)}</pre>`
            }) 
            bot_names.forEach( (elem) => {
              if (event.target.value === elem) {
                document.querySelector(`.${elem}`).style.display = "block"
              } else {
                document.querySelector(`.${elem}`).style.display = "none"
              }
            })
          })

          // copy results to clipboard
          const copyBtn = document.querySelector("#copy")
          copyBtn.addEventListener("click", (e) => {
            navigator.clipboard.writeText(resultsContainer.innerText)
          })

          // json 2 xlsx converter
          const pasteJsonForm = document.querySelector('#paste-json-form')
          const pasteJsonInput =  document.querySelector('#paste-json-input')
          const downloadXlsx = document.querySelector("#downloadxlsx")
          pasteJsonForm.addEventListener("submit", (e) => {
            e.preventDefault();
            let input = pasteJsonInput.value 
            fetch('/json2xlsx', {
              method: 'POST', // *GET, POST, PUT, DELETE, etc.
              mode: 'cors', // no-cors, *cors, same-origin
              cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
              credentials: 'same-origin', // include, *same-origin, omit
              headers: {
                'Content-Type': 'application/json'
                // 'Content-Type': 'application/x-www-form-urlencoded',
              },
              redirect: 'follow', // manual, *follow, error
              referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
              body: input // body data type must match "Content-Type" header
            })
            .then(response => response.blob())
            .then( blob => {
              var file = window.URL.createObjectURL(blob);
              window.location.assign(file);
            })
            .catch((error) => {
              console.error('Error:', JSON.stringify(error));
            });
          })

          // addpage
          const addpageBtn = document.querySelector("#addpage-run")
          addpageBtn.addEventListener("click", (e) => {
            const addPageUrl = document.querySelector("#addpage-url")
            const addPageTitle = document.querySelector("#addpage-title")
            const addPageText = document.querySelector("#addpage-text")
            const data = JSON.stringify([ addPageUrl.value, addPageTitle.value, addPageText.value ])
            fetch('/addpage', {
                method: 'POST', // *GET, POST, PUT, DELETE, etc.
                mode: 'cors', // no-cors, *cors, same-origin
                cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                credentials: 'same-origin', // include, *same-origin, omit
                headers: {
                  'Content-Type': 'application/json'
                  // 'Content-Type': 'application/x-www-form-urlencoded',
                },
                redirect: 'follow', // manual, *follow, error
                referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
                body: data // body data type must match "Content-Type" header
              })
              .then(response => response.json())
              .then(data => {
                resultsContainer.innerHTML += `<br><br><strong>${data.message}</strong>`;
              })
              .catch((error) => {
                console.error('Error:', JSON.stringify(error));
              });
          })

          // CF & DNS checker
          const fileInputCFDNS = document.querySelector('#file-js-example-cfdns input[type=file]');
          fileInputCFDNS.addEventListener("click", (e) => {
            fileInputCFDNS.value = ''
          })
          fileInputCFDNS.onchange = () => {
            if (fileInputCFDNS.files.length > 0) {
              const fileNameCFDNS = document.querySelector('#file-js-example-cfdns .file-name');
              const data = fileInputCFDNS.files[0];
              fileNameCFDNS.innerHTML = data.name;              
              fetch('/cfdns', {
                method: 'POST', // *GET, POST, PUT, DELETE, etc.
                mode: 'cors', // no-cors, *cors, same-origin
                cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                credentials: 'same-origin', // include, *same-origin, omit
                headers: {
                  'Content-Type': 'application/json'
                  // 'Content-Type': 'application/x-www-form-urlencoded',
                },
                redirect: 'follow', // manual, *follow, error
                referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
                body: data // body data type must match "Content-Type" header
              })
              .then(response => response.json())
              .then(data => {
                resultsContainer.innerHTML += `<br><br><strong>${data.message}</strong>`;
              })
              .catch((error) => {
                console.error('Error:', JSON.stringify(error));
              });
            }
          }
          // paste version
          const pasteFormCFDNS = document.querySelector('#paste-form-cfdns')
          const pasteInputCFDNS =  document.querySelector('#paste-input-cfdns')
          pasteFormCFDNS.addEventListener("submit", (e) => {
            e.preventDefault();
            let input = pasteInputCFDNS.value 
            let urls = input.split('\n')
            let data = JSON.stringify(urls)
            fetch('/cfdns', {
              method: 'POST', // *GET, POST, PUT, DELETE, etc.
              mode: 'cors', // no-cors, *cors, same-origin
              cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
              credentials: 'same-origin', // include, *same-origin, omit
              headers: {
                'Content-Type': 'application/json'
                // 'Content-Type': 'application/x-www-form-urlencoded',
              },
              redirect: 'follow', // manual, *follow, error
              referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
              body: data // body data type must match "Content-Type" header
            })
            .then(response => response.json())
            .then(data => {
              resultsContainer.innerHTML += `<br><br><strong>${data.message}</strong>`;
            })
            .catch((error) => {
              console.error('Error:', JSON.stringify(error));
            });
          })

            // Hscraper
          const hscrapeBtn = document.querySelector("#hscrape-run")
          hscrapeBtn.addEventListener("click", (e) => {
              const hscrapeUrl = document.querySelector("#h-url")
              const searchParams = new URLSearchParams()
              searchParams.set("url", hscrapeUrl.value)
              fetch(`/hscrape?${searchParams.toString()}`)
              .then(response => {
                  return response.json()
              })
              .then(function(data) {
                resultsContainer.innerHTML = `<br><pre>${JSON.stringify(data, null, 2)}</pre>`
              })
          })

          // sitecheck scraper
          const fileInput = document.querySelector('#file-js-example input[type=file]');
          // file input version
          fileInput.addEventListener("click", (e) => {
            fileInput.value = ''
          })
          fileInput.onchange = () => {
            if (fileInput.files.length > 0) {
            const fileName = document.querySelector('#file-js-example .file-name');
            fileName.innerHTML = fileInput.files[0].name;           
            const data = fileInput.files[0];
            fetch('/sitecheck', {
              method: 'POST', // *GET, POST, PUT, DELETE, etc.
              mode: 'cors', // no-cors, *cors, same-origin
              cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
              credentials: 'same-origin', // include, *same-origin, omit
              headers: {
                'Content-Type': 'application/json'
                // 'Content-Type': 'application/x-www-form-urlencoded',
              },
              redirect: 'follow', // manual, *follow, error
              referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
              body: data // body data type must match "Content-Type" header
            })
            .then(response => response.json())
            .then(data => {
              resultsContainer.innerHTML += `<br><br><strong>${data.message}</strong>`;
            })
            .catch((error) => {
              console.error('Error:', JSON.stringify(error));
            });
            }
          }
          // paste-a-list version
          const pasteForm = document.querySelector('#paste-form')
          const pasteInput =  document.querySelector('#paste-input')
          pasteForm.addEventListener("submit", (e) => {
            e.preventDefault();
            let input = pasteInput.value 
            let urls = input.split('\n')
            let data = JSON.stringify(urls)
            fetch('/sitecheck', {
              method: 'POST', // *GET, POST, PUT, DELETE, etc.
              mode: 'cors', // no-cors, *cors, same-origin
              cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
              credentials: 'same-origin', // include, *same-origin, omit
              headers: {
                'Content-Type': 'application/json'
                // 'Content-Type': 'application/x-www-form-urlencoded',
              },
              redirect: 'follow', // manual, *follow, error
              referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
              body: data // body data type must match "Content-Type" header
            })
            .then(response => response.json())
            .then(data => {
              resultsContainer.innerHTML += `<br><br><strong>${data.message}</strong>`;
            })
            .catch((error) => {
              console.error('Error:', JSON.stringify(error));
            });
          })

          // lighthouse
          const fileInputLH = document.querySelector('#file-js-example-lh input[type=file]');
          fileInputLH.onchange = () => {
            if (fileInputLH.files.length > 0) {
              const fileName = document.querySelector('#file-js-example-lh .file-name-lh');
              fileName.innerHTML = fileInputLH.files[0].name;
              const lhList = fileInputLH.files[0];
              fetch('/dolighthouse', {
                method: 'POST', // *GET, POST, PUT, DELETE, etc.
                mode: 'cors', // no-cors, *cors, same-origin
                cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                credentials: 'same-origin', // include, *same-origin, omit
                headers: {
                  'Content-Type': 'application/json'
                  // 'Content-Type': 'application/x-www-form-urlencoded',
                },
                redirect: 'follow', // manual, *follow, error
                referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
                body: lhList // body data type must match "Content-Type" header
              })
              .then(response => response.json())
              .then(data => {
                resultsContainer.innerHTML += `<br><br><strong>${data.message}</strong>`;
              })
              .catch((error) => {
                console.error('Error:', JSON.stringify(error));
              });
            }
          }
          // paste version
          const pasteFormLH = document.querySelector('#paste-form-lh')
          const pasteInputLH =  document.querySelector('#paste-input-lh')
          pasteFormLH.addEventListener("submit", (e) => {
            e.preventDefault();
            let input = pasteInputLH.value 
            let urls = input.split('\n')
            let data = JSON.stringify(urls)
            fetch('/dolighthouse', {
              method: 'POST', // *GET, POST, PUT, DELETE, etc.
              mode: 'cors', // no-cors, *cors, same-origin
              cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
              credentials: 'same-origin', // include, *same-origin, omit
              headers: {
                'Content-Type': 'application/json'
                // 'Content-Type': 'application/x-www-form-urlencoded',
              },
              redirect: 'follow', // manual, *follow, error
              referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
              body: data // body data type must match "Content-Type" header
            })
            .then(response => response.json())
            .then(data => {
              resultsContainer.innerHTML += `<br><br><strong>${data.message}</strong>`;
            })
            .catch((error) => {
              console.error('Error:', JSON.stringify(error));
            });
          })
        })()
    </script>

</body>

</html>