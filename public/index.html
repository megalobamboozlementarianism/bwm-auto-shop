<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BWM Auto Shop</title>
    <link rel="icon"
        href="https://bigwestplayground.com/theultimatic/wp-content/uploads/dynamik-gen/theme/images/ultimatic-123.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.0/css/bulma.min.css"
        integrity="sha512-ADrqa2PY1TZtb/MoLZIZu/Z/LlPaWQeDMBV73EMwjGam43/JJ5fqW38Rq8LJOVGCDfrJeOMS3Q/wRUVzW5DkjQ=="
        crossorigin="anonymous" />
</head>

<body>
    <section class="hero">
        <div class="hero-body">
            <div class="container">
                <h1 class="title">
                    BWM Auto Shop
                </h1>
                <h2 class="subtitle">
                    A user interface for Abe's Bots
                </h2>
            </div>
        </div>
    </section>
    <div class="container pb-5">

        <div class="notification">
            <h1 class="title">Single-site H Scraper</h1>
            <p>Input a URL to scrape the H1 and H2 tags for the site (use https://)</p>
            <br>
            <div class="field has-addons">
                <div class="control is-expanded">
                    <input class="input is-fullwidth" type="url" value="https://bigwestplayground.com/theultimatic"
                        id="h-url">
                </div>
                <div class="control">
                    <a class="button is-info" id="hscrape-run">
                        Scrape H tags
                    </a>
                </div>
            </div>
            <div id="hscrape-results">
                <div id="h1-results"></div>
                <div id="h2-results"></div>
            </div>
        </div>

        
        <div class="notification">
            <h1 class="title">Monthly SEO Site Check</h1>
            <p>Input a JSON array of URLs to scrape the title, H1 and H2 tags, schema, social links, as well as desktop and mobile speed scores.</p>
            <br>
            <div id="file-js-example" class="file has-name">
                <label class="file-label">
                    <input class="file-input" type="file" name="">
                    <span class="file-cta">
                        <span class="file-icon">
                            <i class="fas fa-upload"></i>
                        </span>
                        <span class="file-label">
                            Choose a file…
                        </span>
                    </span>
                    <span class="file-name">
                    No file uploaded
                    </span>
                </label>
            </div>
            <br><button class="button is-info is-invisible" id="sc-check" >check</button>
            <button class="button is-info is-invisible" id="sc-reset" >reset</button>
            <div id="hlist-results">
            </div>
        </div>

        <div class="notification">
            <h1 class="title">Run Lighthouse</h1>
            <p>Input a JSON array of URLs to run lighthouse on</p>
            <br>
            <br><button class="button is-info is-invisible" id="lh-check" >check</button>
            <button class="button is-info is-invisible" id="lh-reset" >reset</button>
            <div id="file-js-example-lh" class="file has-name">
                <label class="file-label">
                    <input class="file-input" type="file" name="">
                    <span class="file-cta">
                        <span class="file-icon">
                            <i class="fas fa-upload"></i>
                        </span>
                        <span class="file-label">
                            Choose a file…
                        </span>
                    </span>
                    <span class="file-name file-name-lh">
                    No file uploaded
                    </span>
                </label>
            </div>
            <div id="LH-results">
            </div>
        </div>

          <div class="notification">
            <h1 class="title">Check Cloudflare and DNS</h1>
            <p>Input a JSON array of URLs to get the cloudflare status and DNS records</p>
            <br>
            <div id="file-js-example-cfdns" class="file has-name">
                <label class="file-label">
                    <input class="file-input" type="file" name="">
                    <span class="file-cta">
                        <span class="file-icon">
                            <i class="fas fa-upload"></i>
                        </span>
                        <span class="file-label">
                            Choose a file…
                        </span>
                    </span>
                    <span class="file-name">
                    No file uploaded
                    </span>
                </label>
            </div>
            <br><button class="button is-info is-invisible" id="cfdns-check" >check</button>
            <button class="button is-info is-invisible" id="cfdns-reset" >reset</button>
            <div id="cfdns-results">
            </div>
        </div>
    </div>
    <footer class="footer">
        <div class="content has-text-centered">
            <p>
                well, that's it for now!~
            </p>
        </div>
    </footer>
    <script>
        (() => {
          // cfdns scraper
          const checkBtnCFDNS = document.querySelector("#cfdns-check")
          checkBtnCFDNS.addEventListener("click", (e) => {
            const cfdnsResults = document.querySelector("#cfdns-results")
            fetch(`/check`)
            .then(response => response.json())
            .then(data => {
              cfdnsResults.innerHTML = `<br><pre>${JSON.stringify(data, null, 2)}</pre>`
              resetBtnCFDNS.classList.remove('is-invisible')
            }) 
          })

          const resetBtnCFDNS = document.querySelector("#cfdns-reset")  
          resetBtnCFDNS.addEventListener("click", (e) => {
            const cfdnsresults = document.querySelector("#cfdns-results")
            fetch(`/reset`)
            .then(response => response.json())
            .then(data => {
              cfdnsresults.innerHTML = `<br><pre>${JSON.stringify(data, null, 2)}</pre>`
            }) 
          }) 

          const fileInputCFDNS = document.querySelector('#file-js-example-cfdns input[type=file]');
          fileInputCFDNS.addEventListener("click", (e) => {
            fileInputCFDNS.value = ''
          })
          fileInputCFDNS.onchange = () => {
              if (fileInputCFDNS.files.length > 0) {
              const fileNameCFDNS = document.querySelector('#file-js-example-cfdns .file-name');
              fileNameCFDNS.innerHTML = fileInputCFDNS.files[0].name;
              
              const CFDNSResults = document.querySelector("#cfdns-results")
              const data = fileInputCFDNS.files[0];
              
              fetch('/cfdns', {
                method: 'POST', // *GET, POST, PUT, DELETE, etc.
                mode: 'cors', // no-cors, *cors, same-origin
                cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                credentials: 'same-origin', // include, *same-origin, omit
                headers: {
                  'Content-Type': 'application/json'
                  // 'Content-Type': 'application/x-www-form-urlencoded',
                },
                redirect: 'follow', // manual, *follow, error
                referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
                body: data // body data type must match "Content-Type" header
              })
              .then(response => response.json())
              .then(data => {
                CFDNSResults.innerHTML += `<br><br><strong>${data.message}</strong>`;
                checkBtnCFDNS.classList.remove('is-invisible')
              })
              .catch((error) => {
                console.error('Error:', JSON.stringify(error));
              });
              }
          }

            // Hscraper
          const hscrapeBtn = document.querySelector("#hscrape-run")
          hscrapeBtn.addEventListener("click", (e) => {
              const hscrapeUrl = document.querySelector("#h-url")
              const searchParams = new URLSearchParams()
              searchParams.set("url", hscrapeUrl.value)

              const h1Results = document.querySelector("#h1-results")
              const h2Results = document.querySelector("#h2-results")
              h1Results.innerHTML = "...fetching H1s"
              h2Results.innerHTML = "...fetching H2s"
              fetch(`/hscrape?${searchParams.toString()}`)
              .then(response => {
                  h1Results.innerHTML = "<strong>H1s</strong>"
                  h2Results.innerHTML = "<strong>H2s</strong>"
                  return response.json()
              })
              .then(function(data) {
                  console.log(JSON.stringify(data))
                  data["h1s"].forEach(elem => h1Results.innerHTML += `<br> ${elem}`)
                  data["h2s"].forEach(elem => h2Results.innerHTML += `<br> ${elem}`)
              })
              
          })

            // sitecheck scraper
          const fileInput = document.querySelector('#file-js-example input[type=file]');
          fileInput.addEventListener("click", (e) => {
            fileInput.value = ''
          })
          fileInput.onchange = () => {
              if (fileInput.files.length > 0) {
              const fileName = document.querySelector('#file-js-example .file-name');
              fileName.innerHTML = fileInput.files[0].name;
              
              const hlistResults = document.querySelector("#hlist-results")
              const data = fileInput.files[0];
              
              fetch('/sitecheck', {
                method: 'POST', // *GET, POST, PUT, DELETE, etc.
                mode: 'cors', // no-cors, *cors, same-origin
                cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                credentials: 'same-origin', // include, *same-origin, omit
                headers: {
                  'Content-Type': 'application/json'
                  // 'Content-Type': 'application/x-www-form-urlencoded',
                },
                redirect: 'follow', // manual, *follow, error
                referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
                body: data // body data type must match "Content-Type" header
              })
              .then(response => response.json())
              .then(data => {
                hlistResults.innerHTML += `<br><br><strong>${data.message}</strong>`;
                checkBtn.classList.remove('is-invisible')
              })
              .catch((error) => {
                console.error('Error:', JSON.stringify(error));
              });
              }
          }

          const checkBtn = document.querySelector("#sc-check")
          checkBtn.addEventListener("click", (e) => {
            const hlistResults = document.querySelector("#hlist-results")
            fetch(`/check`)
            .then(response => response.json())
            .then(data => {
              hlistResults.innerHTML = `<br><pre>${JSON.stringify(data, null, 2)}</pre>`
              resetBtn.classList.remove('is-invisible')
            }) 
          })

          const resetBtn = document.querySelector("#sc-reset")  
          resetBtn.addEventListener("click", (e) => {
            const hlistResults = document.querySelector("#hlist-results")
            const LHResults = document.querySelector("##LH-results")
            fetch(`/reset`)
            .then(response => response.json())
            .then(data => {
              hlistResults.innerHTML = `<br><pre>${JSON.stringify(data, null, 2)}</pre>`
            }) 
          }) 

          // lighthouse
           const checkBtnLH = document.querySelector("#lh-check")
          checkBtnLH.addEventListener("click", (e) => {
            const LHResults = document.querySelector("#LH-results")
            fetch(`/check`)
            .then(response => response.json())
            .then(data => {
              LHResults.innerHTML = `<br><pre>${JSON.stringify(data, null, 2)}</pre>`
              lhResetBtn.classList.remove('is-invisible')
            }) 
          })
          const lhResetBtn = document.querySelector("#lh-reset")  
          lhResetBtn.addEventListener("click", (e) => {
            const LHResults = document.querySelector("#LH-results")
            fetch(`/reset`)
            .then(response => response.json())
            .then(data => {
              LHResults.innerHTML = `<br><pre>${JSON.stringify(data, null, 2)}</pre>`
            }) 
          }) 

          const fileInputLH = document.querySelector('#file-js-example-lh input[type=file]');
          fileInputLH.onchange = () => {
              if (fileInputLH.files.length > 0) {
              const fileName = document.querySelector('#file-js-example-lh .file-name-lh');
              fileName.innerHTML = fileInputLH.files[0].name;
              
              const LHResults = document.querySelector("#LH-results")
              const data = fileInputLH.files[0];
              
              fetch('/dolighthouse', {
                method: 'POST', // *GET, POST, PUT, DELETE, etc.
                mode: 'cors', // no-cors, *cors, same-origin
                cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                credentials: 'same-origin', // include, *same-origin, omit
                headers: {
                  'Content-Type': 'application/json'
                  // 'Content-Type': 'application/x-www-form-urlencoded',
                },
                redirect: 'follow', // manual, *follow, error
                referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
                body: data // body data type must match "Content-Type" header
              })
              .then(response => response.json())
              .then(data => {
                LHResults.innerHTML += `<br><br><strong>${data.message}</strong>`;
                checkBtnLH.classList.remove('is-invisible')
              })
              .catch((error) => {
                console.error('Error:', JSON.stringify(error));
              });
            }
          }
          
                
        })()
    </script>

</body>

</html>